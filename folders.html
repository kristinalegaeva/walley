<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <title>Walley — Вход</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Bad+Script&family=Bitter:ital,wght@0,100..900;1,100..900&family=Comfortaa:wght@300..700&family=Jost:ital,wght@0,100..900;1,100..900&family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap"
        rel="stylesheet">
    <style>
        html,
        body {
            margin: 0;
            padding: 0;
            overflow: hidden;
            width: 100%;
            height: 100%;
            color: #4F4242;
        }

        body {
            font-family: 'Jost';
            font-size: 20px;
            background-image: url('background/garden.png');
            background-size: cover;

            background-position: bottom center;
            background-repeat: no-repeat;
            display: flex;
            justify-content: center;
            align-items: center;
            backdrop-filter: blur(10px);
        }

        #opacity-back {
            height: calc(100% - 30px);
            width: calc(100% - 255px);
            background-color: #FBFFEDA0;
            border-radius: 10px;
            display: flex;
            text-align: center;
            align-items: center;
            position: relative;
            justify-content: center;
        }

        #container {
            width: calc(100% - 67px);
            height: calc(100% - 30px);
            display: flex;
            flex-direction: column;
            justify-content: start;
            gap: 20px;
        }

        #search-wrap {
            border: 3.5px solid #C1837B;
            border-radius: 10px;
            background-color: #FBFFED;
            display: flex;
            height: 55px;
        }

        #search-wrap img {
            margin: 10px;
        }

        .search-bar {
            color: #C1837B;
            border: none;
            background: none;
            font-size: 20px;
            width: 95%;
            outline: none;
            font-family: 'Jost';
        }

        .table-wrapper {
            border: 3.5px solid #C1837B;
            border-radius: 10px;
            max-height: 100%;
            overflow-y: auto;
            background-color: #FBFFED;
        }

        .board-table {

            width: 100%;
            border-collapse: collapse;
        }

        .board-table thead {
            background-color: #FBFFED !important;
            position: sticky;
            top: 0;
            border-bottom: 4px solid #C1837B;
        }

        .board-table thead tr th {
            font-weight: unset;
        }

        .board-table thead img {
            vertical-align: sub;
            margin: 0 0 0 5px;
            cursor: pointer;
        }

        .board-table th,
        .board-table td {
            padding: 12px;
            text-align: center;
            /*border-bottom: 1px solid #FBFFED;*/
        }

        #table-body tr:nth-child(even) {
            background-color: #FBFFED;
        }

        #table-body tr:nth-child(odd) {
            background-color: #EEF3D5;
        }

        #table-body tr:hover {
            cursor: pointer;
            background-color: #f5f9e1;
        }

        #table-body tr:hover .more-icon {
            opacity: 1;
        }

        #table-body img {
            vertical-align: middle;
            opacity: 0;
        }

        #table-body tr td:nth-child(3) {
            font-variant-numeric: tabular-nums;

        }

        #table-body tr td:nth-child(1) {
            outline: none;
            max-width: 200px;
            /* ограничиваем ширину */
            overflow: hidden;
            /* скрываем лишнее */
            text-overflow: ellipsis;
            /* троеточие в конце */
            white-space: nowrap;
        }

        .more-button {
            cursor: pointer;
            position: relative;

        }


        .more-buttons {
            position: absolute;
            display: none;
            flex-direction: column;
            gap: 2px;
            top: 50%;
            right: 60px;
            transform: translateY(-50%);
        }

        .more-buttons button {
            background-color: #FBFFED;
            border: none;
            outline: 3px solid #C1837B;
            font-size: 16px;
            padding: 3px 20px;
        }

        .more-buttons button:first-child {
            border-top-right-radius: 5px;
            border-top-left-radius: 5px;
        }

        .more-buttons button:last-child {
            border-bottom-right-radius: 5px;
            border-bottom-left-radius: 5px;
        }


        .more-buttons button:hover {
            background: #EEF3D5;
        }

        .add-button-wrapper {
            display: flex;
            justify-content: center;
        }

        .add-button {
            width: 50px;
            height: 50px;
            border-radius: 10px;
            border: 3.5px solid #C1837B;
            background-color: #FBFFED;
            cursor: pointer;
            display: flex;
            padding: 5px;
        }

        .add-button:hover {
            background-color: #EEF3D5;
        }

        #buttons-wrap {
            position: absolute;
            top: 14px;
            left: 25px;
            display: flex;
            gap: 13px;
        }

        #buttons-wrap img {
            width: 100%;
        }

        #buttons-wrap button {
            width: 77px;
            height: 77px;
            cursor: pointer;
            border: 4px solid #C1837B;
            background: #FBFFED;
            border-radius: 14px;
            padding: 6px;
            margin: 0;
        }

        #buttons-wrap button:hover {
            background: #EEF3D5;
        }
    </style>
</head>

<body>
    <div id="buttons-wrap">
        <button onclick="garden()"><img src="icons/garden.svg"></button>
    </div>
    <div id="opacity-back">
        <div id="container">
            <div id="search-wrap">
                <img src="icons/search.svg">
                <input type="text" placeholder="Поиск..." class="search-bar">

            </div>

            <div class="table-wrapper">
                <table class="board-table">
                    <thead>
                        <tr>
                            <th>Название<img onclick="sortBy('title')" src="icons/sort.svg"></th>
                            <th>Владелец<img onclick="sortBy('user')" src="icons/sort.svg"></th>
                            <th>Последнее изменение<img onclick="sortBy('date')" src="icons/sort.svg"></th>
                            <th></th>

                        </tr>
                    </thead>
                    <tbody id="table-body">
                        <!-- Данные будут добавлены через JS или вручную -->
                    </tbody>
                </table>
            </div>
            <div class="add-button-wrapper">
                <button class="add-button"><img src="icons/add-board.svg"></button>
            </div>
        </div>
    </div>

    <!-- Подключение JS (если потребуется) -->
    <script>
        function garden() {
            window.location.href = 'garden.html';
        }

        // --- Данные ---

        let boards = [
            { title: "Доска 4", user: "azalkinmmm", date: "20.03.25", time: "20:01" },
            { title: "Доска 1", user: "anya_mrkv3", date: "16.03.25", time: "10:15" },
            { title: "Доска 2", user: "nq1s788", date: "16.03.25", time: "14:20" },
            { title: "Доска 3", user: "kristina_legaevа", date: "17.03.25", time: "12:23" },
        ];

        const userSettings = JSON.parse(localStorage.getItem("userSettings"));

        let sortField = null;
        let sortAsc = true;
        let boardCounter = 1;

        const tbody = document.getElementById("table-body");
        const searchInput = document.querySelector(".search-bar");
        const addButton = document.querySelector(".add-button");

        // --- Инициализация ---

        function renderTable() {
            tbody.innerHTML = "";

            const filtered = boards.filter(board =>
                board.title.toLowerCase().includes(searchInput.value.toLowerCase()) ||
                board.user.toLowerCase().includes(searchInput.value.toLowerCase())
            );

            filtered.forEach((board, index) => {
                const row = document.createElement("tr");

                const titleCell = document.createElement("td");
                titleCell.textContent = board.title;

                const userCell = document.createElement("td");
                userCell.textContent = board.user;

                const dateCell = document.createElement("td");
                dateCell.textContent = `${board.time} | ${board.date}`;

                const moreCell = document.createElement("td");
                moreCell.classList.add("more-button");
                moreCell.style.zIndex = 999;
                moreCell.innerHTML = `
            <img src="icons/more.svg" class="more-icon" style="cursor:pointer;">
        `;

                const actions = document.createElement("div");
                actions.classList.add("more-buttons");
                actions.innerHTML = `
            <button class="rename-btn">Изменить</button>
            <button class="delete-btn">Удалить</button>
        `;

                moreCell.appendChild(actions);
                row.appendChild(titleCell);
                row.appendChild(userCell);
                row.appendChild(dateCell);
                row.appendChild(moreCell);

                // События "..."
                moreCell.addEventListener("click", (e) => {
                    e.stopPropagation();
                    actions.style.display = 'flex';
                });

                actions.querySelector(".delete-btn").addEventListener("click", () => {
                    boards.splice(index, 1);
                    renderTable();
                });

                actions.querySelector(".rename-btn").addEventListener("click", () => {
                    titleCell.contentEditable = true;
                    titleCell.focus();

                    titleCell.addEventListener("keydown", (e) => {
                        if (e.key === "Enter") {
                            e.preventDefault();
                            board.title = titleCell.textContent.trim();
                            titleCell.removeAttribute("contentEditable");
                        }
                    });
                });

                row.addEventListener("click", (e) => toBoard(e));
                tbody.appendChild(row);
            });
        }

        function sortBy(field) {
            sortAsc = sortField === field ? !sortAsc : true;
            sortField = field;

            boards.sort((a, b) => {
                let valA, valB;

                if (field === "date") {
                    valA = a.date.split('.').reverse().join('.') + '.' + a.time;
                    valB = b.date.split('.').reverse().join('.') + '.' + b.time;
                } else {
                    valA = a[field].toLowerCase();
                    valB = b[field].toLowerCase();
                }

                if (sortAsc) return valA > valB ? 1 : valA < valB ? -1 : 0;
                else return valA < valB ? 1 : valA > valB ? -1 : 0;
            });

            renderTable();
        }

        function toBoard(e) {
            const target = e.target;

            if (
                target.closest(".more-button") ||
                target.closest(".more-buttons") ||
                (target.tagName === "TD" && target.hasAttribute("contenteditable"))
            ) {
                return;
            }

            const row = target.closest("tr");
            if (!row) return;

            const name = row.querySelector("td")?.textContent.trim() || "";
            const boardInf = { name };

            localStorage.setItem("boardInf", JSON.stringify(boardInf));

            setTimeout(() => {
                window.location.href = "board.html";
            }, 0);
        }

        // --- Обработчики ---

        searchInput.addEventListener("input", renderTable);

        addButton.addEventListener("click", () => {
            const now = new Date();
            const date = now.toLocaleDateString("ru-RU").slice(0, 8);
            const time = now.toLocaleTimeString("ru-RU", { hour: '2-digit', minute: '2-digit' });

            boards.push({
                title: `Новая доска ${boardCounter++}`,
                user: userSettings.username,
                date,
                time
            });

            renderTable();
        });

        document.addEventListener("click", (e) => {
            if (
                !e.target.classList.contains("more-icon") &&
                !e.target.classList.contains("more-button")
            ) {
                document.querySelectorAll(".more-buttons").forEach(el => {
                    el.style.display = "none";
                });
            }
        });

        // --- Старт ---

        renderTable();

    </script>

</body>

</html>